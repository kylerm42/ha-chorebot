# Base configuration - works on macOS, Windows, and Linux
services:
  homeassistant:
    container_name: homeassistant-chorebot-dev
    image: homeassistant/home-assistant:dev
    volumes:
      # Main HA config directory
      - ./dev-config:/config
      # Mount integration Python files (live editing)
      - ./custom_components/chorebot:/config/custom_components/chorebot
      # Mount cards repo dist to www/community (mimics HACS plugin path)
      - ./frontend/dist:/config/www/community/chorebot-cards
    ports:
      - "8123:8123"
    restart: unless-stopped
    user: "1000:1000"
    environment:
      # Disable IPv6 to avoid network issues on some systems
      - DISABLE_IPV6=true

  card-builder:
    container_name: chorebot-card-builder
    image: node:20-alpine
    working_dir: /app
    volumes:
      # Mount entire cards repo for building
      - ./frontend:/app
    command: sh -c "npm install && npm run watch"
    restart: unless-stopped
